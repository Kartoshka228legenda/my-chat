<!DOCTYPE html>
<html>
<head>
    <base href="/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üí¨ –ß–∞—Ç + –°–º–∞–π–ª–∏–∫–∏ + –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* –í–ö–õ–ê–î–ö–ò */
        .tabs {
            display: flex;
            background: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%);
            color: white;
            position: relative;
            z-index: 100;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 16px;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            border-bottom: 3px solid white;
        }

        /* –û–ë–©–ò–ô –ß–ê–¢ */
        .chat-container {
            width: 100%;
            height: calc(100vh - 50px);
            background: white;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%);
            color: white;
            padding: 15px 20px;
            flex-shrink: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .online-status {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .online-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 15px;
            background: #f8f9ff;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 15px;
            max-width: 85%;
            clear: both;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.incoming { float: left; }
        .message.outgoing { float: right; }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.incoming .message-bubble {
            background: white;
            border: 1px solid #e0e0e0;
            border-top-left-radius: 5px;
        }

        .message.outgoing .message-bubble {
            background: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%);
            color: white;
            border-top-right-radius: 5px;
        }

        .message-user {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .message-text {
            font-size: 16px;
            line-height: 1.5;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 6px;
            text-align: right;
        }

        .input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
            position: relative;
        }

        #nameInput {
            width: 80px;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            background: #f8f9fa;
        }

        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 24px;
            font-size: 16px;
            background: #f8f9fa;
            min-height: 44px;
            resize: none;
        }

        #messageInput:focus {
            outline: none;
            border-color: #4a00e0;
            background: white;
        }

        .emoji-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .emoji-btn:hover {
            transform: scale(1.1);
        }

        #sendButton {
            background: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* –ü–ê–ù–ï–õ–¨ –°–ú–ê–ô–õ–ò–ö–û–í */
        .emoji-panel {
            position: absolute;
            bottom: 70px;
            left: 15px;
            right: 15px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 15px;
            display: none;
            flex-direction: column;
            max-height: 300px;
            z-index: 1000;
        }

        .emoji-categories {
            display: flex;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            overflow-x: auto;
            margin-bottom: 10px;
        }

        .emoji-category {
            padding: 8px 12px;
            border: none;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }

        .emoji-category.active {
            background: #4a00e0;
            color: white;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            overflow-y: auto;
            flex: 1;
        }

        .emoji-item {
            font-size: 24px;
            text-align: center;
            padding: 5px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .emoji-item:hover {
            background: #f0f0f0;
        }

        /* –õ–ò–ß–ù–´–ï –ß–ê–¢–´ */
        .private-chats-container {
            display: none;
            flex-direction: column;
            height: calc(100vh - 50px);
            background: white;
        }

        .users-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9ff;
        }

        .user-item {
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }

        .user-item:hover {
            background: #f5f5ff;
            border-color: #4a00e0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-status {
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .private-messages-container {
            display: none;
            flex-direction: column;
            height: calc(100vh - 50px);
            background: white;
        }

        .private-header {
            padding: 15px;
            background: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            .tab {
                padding: 12px 10px;
                font-size: 14px;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .emoji-panel {
                left: 10px;
                right: 10px;
                max-height: 250px;
            }
        }

        @media (max-width: 480px) {
            .emoji-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            #nameInput {
                width: 60px;
                font-size: 12px;
                padding: 8px 10px;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4cd964;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
        <div class="tab active" data-tab="public">üí¨ –û–±—â–∏–π —á–∞—Ç</div>
        <div class="tab" data-tab="private">üë• –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
    </div>

    <!-- –û–ë–©–ò–ô –ß–ê–¢ -->
    <div class="chat-container" id="publicChat">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>
                üí¨ –û–±—â–∏–π —á–∞—Ç
            </h1>
            <div class="online-status">
                <div class="online-dot"></div>
                <span id="onlineCount">1</span> –æ–Ω–ª–∞–π–Ω
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="messages-container" id="messagesContainer">
            <div style="text-align: center; color: #666; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 10px;">üëã</div>
                <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
                <p>–≠—Ç–æ –æ–±—â–∏–π —á–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤ -->
        <div class="emoji-panel" id="emojiPanel">
            <div class="emoji-categories" id="emojiCategories"></div>
            <div class="emoji-grid" id="emojiGrid"></div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ -->
        <div class="input-container">
            <input type="text" id="nameInput" placeholder="–ò–º—è" value="–ì–æ—Å—Ç—å" maxlength="20">
            <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
            <button class="emoji-btn" id="emojiButton">üòä</button>
            <button id="sendButton">‚û§</button>
        </div>
    </div>

    <!-- –õ–ò–ß–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø - –°–ü–ò–°–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
    <div class="private-chats-container" id="privateChats">
        <div class="header">
            <h1>üë• –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
        </div>
        <div class="users-list" id="usersList">
            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∑–¥–µ—Å—å -->
            <div style="text-align: center; color: #666; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 10px;">üë§</div>
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</h3>
                <p>–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤—Å–µ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</p>
            </div>
        </div>
    </div>

    <!-- –õ–ò–ß–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø - –ß–ê–¢ –° –ö–û–ù–ö–†–ï–¢–ù–´–ú –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ú -->
    <div class="private-messages-container" id="privateMessages">
        <div class="private-header">
            <button class="back-btn" id="backToUsers">‚Üê</button>
            <div>
                <h2 id="privateChatWith">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <div class="online-status">
                    <div class="online-dot"></div>
                    <span id="privateOnlineStatus">–æ–Ω–ª–∞–π–Ω</span>
                </div>
            </div>
        </div>
        
        <div class="messages-container" id="privateMessagesContainer">
            <!-- –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <div class="input-container">
            <input type="text" id="privateMessageInput" placeholder="–õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
            <button class="emoji-btn private-emoji-btn">üòä</button>
            <button id="privateSendButton">‚û§</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <script>
        // === –ö–û–ù–§–ò–ì FIREBASE ===
        const firebaseConfig = {
            apiKey: "AIzaSyDozb-394r3thXXzLdnSE1W-n8-5ts-VLQ",
            authDomain: "chat-66525.firebaseapp.com",
            databaseURL: "https://chat-66525-default-rtdb.firebaseio.com",
            projectId: "chat-66525",
            storageBucket: "chat-66525.firebasestorage.app",
            messagingSenderId: "553583707162",
            appId: "1:553583707162:web:795d742acf5a4ee5fbbda3",
            measurementId: "G-JHSN8XBHZE"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // ============ –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============
        let userName = localStorage.getItem('chat_name') || '–ì–æ—Å—Ç—å' + Math.floor(Math.random() * 1000);
        let userId = localStorage.getItem('chat_user_id');
        let currentPrivateChat = null;
        let emojiPanelVisible = false;
        let onlineUsers = {};
        let userStatusRef = null;
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –Ω–µ—Ç
        if (!userId) {
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('chat_user_id', userId);
        }
        
        // ============ –§–£–ù–ö–¶–ò–ò ============
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserName() {
            const newName = document.getElementById('nameInput').value.trim() || '–ì–æ—Å—Ç—å';
            if (newName !== userName) {
                userName = newName;
                localStorage.setItem('chat_name', userName);
                updateUserInfo();
                showNotification('–ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞: ' + userName);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ Firebase
        function updateUserInfo() {
            if (userStatusRef) {
                userStatusRef.update({ 
                    name: userName,
                    lastSeen: Date.now()
                });
            }
        }
        
        // ============ –°–ú–ê–ô–õ–ò–ö–ò ============
        const emojiCategories = [
            { name: "popular", title: "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ" },
            { name: "smileys", title: "–≠–º–æ—Ü–∏–∏" },
            { name: "people", title: "–õ—é–¥–∏" },
            { name: "animals", title: "–ñ–∏–≤–æ—Ç–Ω—ã–µ" },
            { name: "food", title: "–ï–¥–∞" },
            { name: "activities", title: "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏" },
            { name: "travel", title: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è" },
            { name: "objects", title: "–û–±—ä–µ–∫—Ç—ã" },
            { name: "symbols", title: "–°–∏–º–≤–æ–ª—ã" },
            { name: "flags", title: "–§–ª–∞–≥–∏" }
        ];
        
        // –ë–ê–ó–ê –°–ú–ê–ô–õ–ò–ö–û–í (500+ —Å–º–∞–π–ª–∏–∫–æ–≤)
        const emojis = {
            popular: [
                "üòÄ", "üòÇ", "ü•∞", "üòé", "üëç", "‚ù§Ô∏è", "üî•", "üéâ", "ü§î", "üëè",
                "üíØ", "‚ú®", "üòä", "üòç", "üò¢", "üò°", "ü§£", "üòú", "üôè", "üí™"
            ],
            smileys: [
                "üòÄ", "üòÉ", "üòÑ", "üòÅ", "üòÜ", "üòÖ", "ü§£", "üòÇ", "üôÇ", "üôÉ",
                "üòâ", "üòä", "üòá", "ü•∞", "üòç", "ü§©", "üòò", "üòó", "üòö", "üòô",
                "üòã", "üòõ", "üòú", "ü§™", "üòù", "ü§ë", "ü§ó", "ü§≠", "ü§´", "ü§î",
                "ü§ê", "ü§®", "üòê", "üòë", "üò∂", "üòè", "üòí", "üôÑ", "üò¨", "ü§•",
                "üòå", "üòî", "üò™", "ü§§", "üò¥", "üò∑", "ü§í", "ü§ï", "ü§¢", "ü§Æ",
                "ü§ß", "ü•µ", "ü•∂", "ü•¥", "üòµ", "ü§Ø", "ü§†", "ü•≥", "üòé", "ü§ì",
                "üßê", "üòï", "üòü", "üôÅ", "üòÆ", "üòØ", "üò≤", "üò≥", "ü•∫", "üò¶",
                "üòß", "üò®", "üò∞", "üò•", "üò¢", "üò≠", "üò±", "üòñ", "üò£", "üòû",
                "üòì", "üò©", "üò´", "ü•±", "üò§", "üò°", "üò†", "ü§¨", "üòà", "üëø"
            ],
            people: [
                "üë∂", "üßí", "üë¶", "üëß", "üßë", "üë®", "üë©", "üßî", "üë®‚Äçü¶∞", "üë©‚Äçü¶∞",
                "üë®‚Äçü¶±", "üë©‚Äçü¶±", "üë®‚Äçü¶≥", "üë©‚Äçü¶≥", "üë®‚Äçü¶≤", "üë©‚Äçü¶≤", "üë±", "üë±‚Äç‚ôÇÔ∏è", "üë±‚Äç‚ôÄÔ∏è", "üßì",
                "üë¥", "üëµ", "üôç", "üôç‚Äç‚ôÇÔ∏è", "üôç‚Äç‚ôÄÔ∏è", "üôé", "üôé‚Äç‚ôÇÔ∏è", "üôé‚Äç‚ôÄÔ∏è", "üôÖ", "üôÖ‚Äç‚ôÇÔ∏è",
                "üôÖ‚Äç‚ôÄÔ∏è", "üôÜ", "üôÜ‚Äç‚ôÇÔ∏è", "üôÜ‚Äç‚ôÄÔ∏è", "üíÅ", "üíÅ‚Äç‚ôÇÔ∏è", "üíÅ‚Äç‚ôÄÔ∏è", "üôã", "üôã‚Äç‚ôÇÔ∏è", "üôã‚Äç‚ôÄÔ∏è",
                "üôá", "üôá‚Äç‚ôÇÔ∏è", "üôá‚Äç‚ôÄÔ∏è", "ü§¶", "ü§¶‚Äç‚ôÇÔ∏è", "ü§¶‚Äç‚ôÄÔ∏è", "ü§∑", "ü§∑‚Äç‚ôÇÔ∏è", "ü§∑‚Äç‚ôÄÔ∏è", "üë®‚Äç‚öïÔ∏è",
                "üë©‚Äç‚öïÔ∏è", "üë®‚Äçüéì", "üë©‚Äçüéì", "üë®‚Äçüè´", "üë©‚Äçüè´", "üë®‚Äç‚öñÔ∏è", "üë©‚Äç‚öñÔ∏è", "üë®‚Äçüåæ", "üë©‚Äçüåæ", "üë®‚Äçüç≥",
                "üë©‚Äçüç≥", "üë®‚Äçüîß", "üë©‚Äçüîß", "üë®‚Äçüè≠", "üë©‚Äçüè≠", "üë®‚Äçüíº", "üë©‚Äçüíº", "üë®‚Äçüî¨", "üë©‚Äçüî¨", "üë®‚Äçüíª",
                "üë©‚Äçüíª", "üë®‚Äçüé§", "üë©‚Äçüé§", "üë®‚Äçüé®", "üë©‚Äçüé®", "üë®‚Äç‚úàÔ∏è", "üë©‚Äç‚úàÔ∏è", "üë®‚ÄçüöÄ", "üë©‚ÄçüöÄ", "üë®‚Äçüöí",
                "üë©‚Äçüöí", "üëÆ", "üëÆ‚Äç‚ôÇÔ∏è", "üëÆ‚Äç‚ôÄÔ∏è", "üïµÔ∏è", "üïµÔ∏è‚Äç‚ôÇÔ∏è", "üïµÔ∏è‚Äç‚ôÄÔ∏è", "üíÇ", "üíÇ‚Äç‚ôÇÔ∏è", "üíÇ‚Äç‚ôÄÔ∏è"
            ],
            animals: [
                "üê∂", "üê±", "üê≠", "üêπ", "üê∞", "ü¶ä", "üêª", "üêº", "üê®", "üêØ",
                "ü¶Å", "üêÆ", "üê∑", "üêΩ", "üê∏", "üêµ", "üôà", "üôâ", "üôä", "üêí",
                "üêî", "üêß", "üê¶", "üê§", "üê£", "üê•", "ü¶Ü", "ü¶Ö", "ü¶â", "ü¶á",
                "üê∫", "üêó", "üê¥", "ü¶Ñ", "üêù", "üêõ", "ü¶ã", "üêå", "üêû", "üêú",
                "ü¶ü", "ü¶ó", "üï∑Ô∏è", "üï∏Ô∏è", "ü¶Ç", "üê¢", "üêç", "ü¶é", "ü¶ñ", "ü¶ï",
                "üêô", "ü¶ë", "ü¶ê", "ü¶û", "ü¶Ä", "üê°", "üê†", "üêü", "üê¨", "üê≥",
                "üêã", "ü¶à", "üêä", "üêÖ", "üêÜ", "ü¶ì", "ü¶ç", "ü¶ß", "üêò", "ü¶õ",
                "ü¶è", "üê™", "üê´", "ü¶í", "ü¶ò", "üêÉ", "üêÇ", "üêÑ", "üêé", "üêñ",
                "üêè", "üêë", "ü¶ô", "üêê", "ü¶å", "üêï", "üê©", "ü¶Æ", "üêï‚Äçü¶∫", "üêà"
            ],
            food: [
                "üçè", "üçé", "üçê", "üçä", "üçã", "üçå", "üçâ", "üçá", "üçì", "ü´ê",
                "üçà", "üçí", "üçë", "ü•≠", "üçç", "ü••", "ü•ù", "üçÖ", "üçÜ", "ü•ë",
                "ü•¶", "ü•¨", "ü•í", "üå∂Ô∏è", "ü´ë", "üåΩ", "ü•ï", "ü´í", "üßÑ", "üßÖ",
                "ü•î", "üç†", "ü´ò", "ü•ê", "ü•Ø", "üçû", "ü•ñ", "ü•®", "üßÄ", "ü•ö",
                "üç≥", "üßà", "ü•û", "üßá", "ü•ì", "ü•©", "üçó", "üçñ", "ü¶¥", "üå≠",
                "üçî", "üçü", "üçï", "ü´ì", "ü•™", "ü•ô", "üßÜ", "üåÆ", "üåØ", "ü´î",
                "ü•ó", "ü•ò", "ü´ï", "ü•´", "üçù", "üçú", "üç≤", "üçõ", "üç£", "üç±",
                "ü•ü", "ü¶™", "üç§", "üçô", "üçö", "üçò", "üç•", "ü•†", "ü•Æ", "üç¢",
                "üç°", "üçß", "üç®", "üç¶", "ü•ß", "üßÅ", "üç∞", "üéÇ", "üçÆ", "üç≠"
            ],
            activities: [
                "‚öΩ", "üèÄ", "üèà", "‚öæ", "ü•é", "üéæ", "üèê", "üèâ", "ü•è", "üé±",
                "ü™Ä", "üèì", "üè∏", "üèí", "üèë", "ü•ç", "üèè", "ü™É", "ü•Ö", "‚õ≥",
                "ü™Å", "üèπ", "üé£", "ü§ø", "ü•ä", "ü•ã", "üéΩ", "üõπ", "üõº", "üõ∑",
                "‚õ∏Ô∏è", "ü•å", "üéø", "‚õ∑Ô∏è", "üèÇ", "ü™Ç", "üèãÔ∏è", "üèãÔ∏è‚Äç‚ôÇÔ∏è", "üèãÔ∏è‚Äç‚ôÄÔ∏è", "ü§º",
                "ü§º‚Äç‚ôÇÔ∏è", "ü§º‚Äç‚ôÄÔ∏è", "ü§∏", "ü§∏‚Äç‚ôÇÔ∏è", "ü§∏‚Äç‚ôÄÔ∏è", "ü§∫", "ü§æ", "ü§æ‚Äç‚ôÇÔ∏è", "ü§æ‚Äç‚ôÄÔ∏è", "üèåÔ∏è",
                "üèåÔ∏è‚Äç‚ôÇÔ∏è", "üèåÔ∏è‚Äç‚ôÄÔ∏è", "üèá", "üßò", "üßò‚Äç‚ôÇÔ∏è", "üßò‚Äç‚ôÄÔ∏è", "üèÑ", "üèÑ‚Äç‚ôÇÔ∏è", "üèÑ‚Äç‚ôÄÔ∏è", "üèä",
                "üèä‚Äç‚ôÇÔ∏è", "üèä‚Äç‚ôÄÔ∏è", "ü§Ω", "ü§Ω‚Äç‚ôÇÔ∏è", "ü§Ω‚Äç‚ôÄÔ∏è", "üö£", "üö£‚Äç‚ôÇÔ∏è", "üö£‚Äç‚ôÄÔ∏è", "üßó", "üßó‚Äç‚ôÇÔ∏è",
                "üßó‚Äç‚ôÄÔ∏è", "üöµ", "üöµ‚Äç‚ôÇÔ∏è", "üöµ‚Äç‚ôÄÔ∏è", "üö¥", "üö¥‚Äç‚ôÇÔ∏è", "üö¥‚Äç‚ôÄÔ∏è", "üèÜ", "ü•á", "ü•à",
                "ü•â", "üèÖ", "üéñÔ∏è", "üèµÔ∏è", "üéóÔ∏è", "üé´", "üéüÔ∏è", "üé™", "ü§π", "ü§π‚Äç‚ôÇÔ∏è"
            ],
            travel: [
                "üöó", "üöï", "üöô", "üöå", "üöé", "üèéÔ∏è", "üöì", "üöë", "üöí", "üöê",
                "üõª", "üöö", "üöõ", "üöú", "ü¶Ø", "ü¶Ω", "ü¶º", "üõ¥", "üö≤", "üõµ",
                "üèçÔ∏è", "üõ∫", "üö®", "üöî", "üöç", "üöò", "üöñ", "üö°", "üö†", "üöü",
                "üöÉ", "üöã", "üöû", "üöù", "üöÑ", "üöÖ", "üöà", "üöÇ", "üöÜ", "üöá",
                "üöä", "üöâ", "‚úàÔ∏è", "üõ´", "üõ¨", "üõ©Ô∏è", "üí∫", "üõ∞Ô∏è", "üöÄ", "üõ∏",
                "üöÅ", "üõ∂", "‚õµ", "üö§", "üõ•Ô∏è", "üõ≥Ô∏è", "‚õ¥Ô∏è", "üö¢", "‚öì", "ü™ù",
                "üåç", "üåé", "üåè", "üó∫Ô∏è", "üóæ", "üß≠", "üèîÔ∏è", "‚õ∞Ô∏è", "üåã", "üóª",
                "üèïÔ∏è", "üèñÔ∏è", "üèúÔ∏è", "üèùÔ∏è", "üèûÔ∏è", "üèüÔ∏è", "üèõÔ∏è", "üèóÔ∏è", "üß±", "ü™®"
            ],
            objects: [
                "üíé", "üî™", "üè∫", "üóø", "ü™ô", "üí∞", "üí¥", "üíµ", "üí∂", "üí∑",
                "üí∏", "üí≥", "üßæ", "‚úâÔ∏è", "üìß", "üì®", "üì©", "üì§", "üì•", "üì¶",
                "üì´", "üì™", "üì¨", "üì≠", "üìÆ", "üó≥Ô∏è", "‚úèÔ∏è", "‚úíÔ∏è", "üñãÔ∏è", "üñäÔ∏è",
                "üñåÔ∏è", "üñçÔ∏è", "üìù", "üíº", "üìÅ", "üìÇ", "üóÇÔ∏è", "üìÖ", "üìÜ", "üóíÔ∏è",
                "üìä", "üìà", "üìâ", "üìã", "üìå", "üìç", "üìé", "üñáÔ∏è", "üìè", "üìê",
                "‚úÇÔ∏è", "üóÉÔ∏è", "üóÑÔ∏è", "üóëÔ∏è", "üîí", "üîì", "üîè", "üîê", "üîë", "üóùÔ∏è",
                "üî®", "ü™ì", "‚õèÔ∏è", "‚öíÔ∏è", "üõ†Ô∏è", "üó°Ô∏è", "‚öîÔ∏è", "üî´", "üèπ", "üõ°Ô∏è",
                "üîß", "üî©", "‚öôÔ∏è", "üóúÔ∏è", "‚öñÔ∏è", "ü¶Ø", "üîó", "‚õìÔ∏è", "üß∞", "üß≤"
            ],
            symbols: [
                "‚ù§Ô∏è", "üß°", "üíõ", "üíö", "üíô", "üíú", "üñ§", "ü§ç", "ü§é", "üíî",
                "‚ù£Ô∏è", "üíï", "üíû", "üíì", "üíó", "üíñ", "üíò", "üíù", "üíü", "‚òÆÔ∏è",
                "‚úùÔ∏è", "‚ò™Ô∏è", "üïâÔ∏è", "‚ò∏Ô∏è", "‚ú°Ô∏è", "üîØ", "üïé", "‚òØÔ∏è", "‚ò¶Ô∏è", "üõê",
                "‚õé", "‚ôà", "‚ôâ", "‚ôä", "‚ôã", "‚ôå", "‚ôç", "‚ôé", "‚ôè", "‚ôê",
                "‚ôë", "‚ôí", "‚ôì", "üÜî", "‚öõÔ∏è", "üâë", "‚ò¢Ô∏è", "‚ò£Ô∏è", "üì¥", "üì≥",
                "üà∂", "üàö", "üà∏", "üà∫", "üà∑Ô∏è", "‚ú¥Ô∏è", "üÜö", "üíÆ", "üâê", "„äôÔ∏è",
                "„äóÔ∏è", "üà¥", "üàµ", "üàπ", "üà≤", "üÖ∞Ô∏è", "üÖ±Ô∏è", "üÜé", "üÜë", "üÖæÔ∏è",
                "üÜò", "‚ùå", "‚≠ï", "üõë", "‚õî", "üìõ", "üö´", "üíØ", "üí¢", "‚ô®Ô∏è"
            ],
            flags: [
                "üèÅ", "üö©", "üéå", "üè¥", "üè≥Ô∏è", "üè≥Ô∏è‚Äçüåà", "üè≥Ô∏è‚Äç‚ößÔ∏è", "üè¥‚Äç‚ò†Ô∏è", "üá¶üá´", "üá¶üáΩ",
                "üá¶üá±", "üá©üáø", "üá¶üá∏", "üá¶üá©", "üá¶üá¥", "üá¶üáÆ", "üá¶üá∂", "üá¶üá¨", "üá¶üá∑", "üá¶üá≤",
                "üá¶üáº", "üá¶üá∫", "üá¶üáπ", "üá¶üáø", "üáßüá∏", "üáßüá≠", "üáßüá©", "üáßüáß", "üáßüáæ", "üáßüá™",
                "üáßüáø", "üáßüáØ", "üáßüá≤", "üáßüáπ", "üáßüá¥", "üáßüá¶", "üáßüáº", "üáßüá∑", "üáÆüá¥", "üáªüá¨",
                "üáßüá≥", "üáßüá¨", "üáßüá´", "üáßüáÆ", "üá∞üá≠", "üá®üá≤", "üá®üá¶", "üáÆüá®", "üá®üáª", "üáßüá∂",
                "üá∞üáæ", "üá®üá´", "üáπüá©", "üá®üá±", "üá®üá≥", "üá®üáΩ", "üá®üá®", "üá®üá¥", "üá∞üá≤", "üá®üá¨",
                "üá®üá©", "üá®üá∞", "üá®üá∑", "üá®üáÆ", "üá≠üá∑", "üá®üá∫", "üá®üáº", "üá®üáæ", "üá®üáø", "üá©üá∞",
                "üá©üáØ", "üá©üá≤", "üá©üá¥", "üá™üá®", "üá™üá¨", "üá∏üáª", "üá¨üá∂", "üá™üá∑", "üá™üá™", "üá™üáπ"
            ]
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏ —Å–º–∞–π–ª–∏–∫–æ–≤
        function initEmojiPanel() {
            const categoriesContainer = document.getElementById('emojiCategories');
            const gridContainer = document.getElementById('emojiGrid');
            
            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            emojiCategories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'emoji-category';
                btn.textContent = category.title;
                btn.dataset.category = category.name;
                btn.addEventListener('click', () => showEmojiCategory(category.name));
                categoriesContainer.appendChild(btn);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            showEmojiCategory('popular');
            
            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ —Å–º–∞–π–ª–∏–∫–æ–≤
            document.getElementById('emojiButton').addEventListener('click', toggleEmojiPanel);
            document.querySelector('.private-emoji-btn').addEventListener('click', togglePrivateEmojiPanel);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –ø–∞–Ω–µ–ª–∏
            document.addEventListener('click', (e) => {
                const emojiPanel = document.getElementById('emojiPanel');
                const emojiBtn = document.getElementById('emojiButton');
                const privateEmojiBtn = document.querySelector('.private-emoji-btn');
                
                if (emojiPanel.style.display === 'flex' && 
                    !emojiPanel.contains(e.target) && 
                    !emojiBtn.contains(e.target) &&
                    !privateEmojiBtn.contains(e.target)) {
                    emojiPanel.style.display = 'none';
                    emojiPanelVisible = false;
                }
            });
        }
        
        function showEmojiCategory(categoryName) {
            const gridContainer = document.getElementById('emojiGrid');
            const categoryButtons = document.querySelectorAll('.emoji-category');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            categoryButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === categoryName);
            });
            
            // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É
            gridContainer.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–º–∞–π–ª–∏–∫–∏
            emojis[categoryName].forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', () => insertEmoji(emoji));
                gridContainer.appendChild(emojiItem);
            });
        }
        
        function toggleEmojiPanel() {
            const emojiPanel = document.getElementById('emojiPanel');
            emojiPanelVisible = !emojiPanelVisible;
            emojiPanel.style.display = emojiPanelVisible ? 'flex' : 'none';
        }
        
        function togglePrivateEmojiPanel() {
            const emojiPanel = document.getElementById('emojiPanel');
            emojiPanelVisible = !emojiPanelVisible;
            emojiPanel.style.display = emojiPanelVisible ? 'flex' : 'none';
        }
        
        function insertEmoji(emoji) {
            const activeInput = currentPrivateChat ? 
                document.getElementById('privateMessageInput') : 
                document.getElementById('messageInput');
            
            const start = activeInput.selectionStart;
            const end = activeInput.selectionEnd;
            const text = activeInput.value;
            
            activeInput.value = text.substring(0, start) + emoji + text.substring(end);
            activeInput.focus();
            activeInput.selectionStart = activeInput.selectionEnd = start + emoji.length;
        }
        
        // ============ –û–ë–©–ò–ô –ß–ê–¢ ============
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const messageText = messageInput.value.trim();
            
            if (!messageText) return;
            
            const newName = document.getElementById('nameInput').value.trim() || '–ì–æ—Å—Ç—å';
            if (newName !== userName) {
                userName = newName;
                localStorage.setItem('chat_name', userName);
                updateUserInfo();
                showNotification('–ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞: ' + userName);
            }
            
            const message = {
                text: messageText,
                user: userName,
                userId: userId,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                timestamp: Date.now(),
                type: 'public'
            };
            
            database.ref('messages/public').push(message);
            messageInput.value = '';
            messageInput.focus();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤
            document.getElementById('emojiPanel').style.display = 'none';
            emojiPanelVisible = false;
        }
        
        function addMessageToUI(message, isOwn = false) {
            const messagesContainer = document.getElementById('messagesContainer');
            
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const welcomeMsg = messagesContainer.querySelector('div[style*="text-align: center"]');
            if (welcomeMsg) welcomeMsg.remove();
            
            const messageDiv = document.createElement('div');
            const isOurMessage = message.userId === userId;
            
            messageDiv.className = `message ${isOwn || isOurMessage ? 'outgoing' : 'incoming'}`;
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="message-user">
                        ${isOurMessage ? '–í—ã' : message.user}
                    </div>
                    <div class="message-text">${message.text}</div>
                    <div class="message-time">${message.time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }
        
        // ============ –õ–ò–ß–ù–´–ï –ß–ê–¢–´ ============
        function loadUsersList() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            Object.keys(onlineUsers).forEach(otherUserId => {
                if (otherUserId === userId) return;
                
                const user = onlineUsers[otherUserId];
                const isOnline = user.online && (Date.now() - user.lastSeen < 30000);
                
                if (!isOnline) return;
                
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.dataset.userId = otherUserId;
                
                // –ë—É–∫–≤–∞ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∫–∏
                const firstLetter = user.name.charAt(0).toUpperCase();
                
                userItem.innerHTML = `
                    <div class="user-avatar">${firstLetter}</div>
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-status">
                            <span class="online-dot" style="width: 6px; height: 6px; background: ${isOnline ? '#00ff88' : '#999'}"></span>
                            ${isOnline ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ—Ñ–ª–∞–π–Ω'}
                        </div>
                    </div>
                `;
                
                userItem.addEventListener('click', () => openPrivateChat(otherUserId, user.name));
                usersList.appendChild(userItem);
            });
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            if (Object.keys(onlineUsers).length <= 1) {
                usersList.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üë§</div>
                        <h3>–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <p>–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —á–∞—Ç—É</p>
                    </div>
                `;
            }
        }
        
        function openPrivateChat(otherUserId, otherUserName) {
            currentPrivateChat = otherUserId;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á–∞—Ç, —Å–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
            document.getElementById('privateChats').style.display = 'none';
            document.getElementById('privateMessages').style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('privateChatWith').textContent = otherUserName;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
            loadPrivateMessages(otherUserId);
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('privateMessageInput').focus();
        }
        
        function loadPrivateMessages(otherUserId) {
            const chatId = getChatId(userId, otherUserId);
            const container = document.getElementById('privateMessagesContainer');
            container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>';
            
            database.ref('private_messages/' + chatId).limitToLast(50).on('value', (snapshot) => {
                const messages = snapshot.val();
                container.innerHTML = '';
                
                if (messages) {
                    Object.values(messages).forEach(msg => {
                        addPrivateMessageToUI(msg);
                    });
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; color: #666; padding: 40px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">üí¨</div>
                            <h3>–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                            <p>–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥</p>
                        </div>
                    `;
                }
                
                setTimeout(() => {
                    container.scrollTop = container.scrollHeight;
                }, 100);
            });
        }
        
        function sendPrivateMessage() {
            if (!currentPrivateChat) return;
            
            const input = document.getElementById('privateMessageInput');
            const messageText = input.value.trim();
            
            if (!messageText) return;
            
            const chatId = getChatId(userId, currentPrivateChat);
            const message = {
                text: messageText,
                from: userId,
                to: currentPrivateChat,
                fromName: userName,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                timestamp: Date.now()
            };
            
            database.ref('private_messages/' + chatId).push(message);
            input.value = '';
            input.focus();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤
            document.getElementById('emojiPanel').style.display = 'none';
            emojiPanelVisible = false;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É
            addPrivateMessageToUI(message);
        }
        
        function addPrivateMessageToUI(message) {
            const container = document.getElementById('privateMessagesContainer');
            
            // –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—É—Å—Ç–æ–º —á–∞—Ç–µ
            const emptyMsg = container.querySelector('div[style*="text-align: center"]');
            if (emptyMsg) emptyMsg.remove();
            
            const messageDiv = document.createElement('div');
            const isOurMessage = message.from === userId;
            
            messageDiv.className = `message ${isOurMessage ? 'outgoing' : 'incoming'}`;
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="message-user">
                        ${isOurMessage ? '–í—ã' : message.fromName}
                    </div>
                    <div class="message-text">${message.text}</div>
                    <div class="message-time">${message.time}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }
        
        function getChatId(userId1, userId2) {
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º ID —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π chatId –¥–ª—è –ø–∞—Ä—ã
            return [userId1, userId2].sort().join('_');
        }
        
        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò ============
        function initTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    document.getElementById('publicChat').style.display = tabName === 'public' ? 'flex' : 'none';
                    document.getElementById('privateChats').style.display = tabName === 'private' ? 'flex' : 'none';
                    document.getElementById('privateMessages').style.display = 'none';
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –ª–∏—á–Ω—ã–π —á–∞—Ç
                    currentPrivateChat = null;
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤
                    document.getElementById('emojiPanel').style.display = 'none';
                    emojiPanelVisible = false;
                    
                    // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    if (tabName === 'private') {
                        loadUsersList();
                    }
                });
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
            document.getElementById('backToUsers').addEventListener('click', () => {
                document.getElementById('privateMessages').style.display = 'none';
                document.getElementById('privateChats').style.display = 'flex';
                currentPrivateChat = null;
            });
        }
        
        // ============ –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ============
        function showNotification(text) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = text;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }
        
        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            initEmojiPanel();
            initTabs();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–º–µ–Ω–∏
            document.getElementById('nameInput').value = userName;
            document.getElementById('nameInput').addEventListener('change', updateUserName);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            userStatusRef = database.ref('online_users/' + userId);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            userStatusRef.set({
                name: userName,
                online: true,
                lastSeen: Date.now()
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            document.getElementById('privateSendButton').addEventListener('click', sendPrivateMessage);
            document.getElementById('privateMessageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendPrivateMessage();
                }
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            database.ref('messages/public').orderByChild('timestamp').limitToLast(50).on('child_added', (snapshot) => {
                addMessageToUI(snapshot.val());
            });
            
            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            database.ref('online_users').on('value', (snapshot) => {
                onlineUsers = snapshot.val() || {};
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω
                let onlineCount = 0;
                Object.values(onlineUsers).forEach(user => {
                    if (user.online && (Date.now() - user.lastSeen < 30000)) {
                        onlineCount++;
                    }
                });
                document.getElementById('onlineCount').textContent = onlineCount;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞)
                if (document.getElementById('privateChats').style.display === 'flex') {
                    loadUsersList();
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                userStatusRef.update({ lastSeen: Date.now() });
            }, 10000);
            
            // –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –æ—Ñ—Ñ–ª–∞–π–Ω
            window.addEventListener('beforeunload', () => {
                userStatusRef.update({ online: false });
            });
            
            // –ü—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –≤–∫–ª–∞–¥–∫–∏
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    userStatusRef.update({ lastSeen: Date.now() });
                } else {
                    userStatusRef.update({ online: true, lastSeen: Date.now() });
                }
            });
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –æ–±—â–µ–≥–æ —á–∞—Ç–∞
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>